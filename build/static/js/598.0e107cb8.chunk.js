"use strict";(self.webpackChunkdatta_able_rv18_0_4=self.webpackChunkdatta_able_rv18_0_4||[]).push([[598],{42598:(t,e,a)=>{a.r(e),a.d(e,{UsersGroup:()=>v,default:()=>L});var i=a(72791),s=a(74387),o=a(17451),n=a(68962),r=a.n(n),l=a(89139),d=a(43360),h=a(45085),u=a(50649),c=a.n(u),p=a(80184);class g extends i.Component{constructor(t){super(t),this.onSelectionChanged=t=>{this.setState({SelectID:t.selectedRowsData[0].AutoID})},this.onSelectClick=t=>{this.props.OnHide(this.state.SelectID)},this.onCloseClick=t=>{this.props.OnHide(0)},this.state={SelectID:0,jList:[]}}componentDidMount(){}render(){return(0,p.jsx)(i.Fragment,{children:(0,p.jsxs)(h.Z,{size:"xl",show:this.props.Show,onHide:this.onCloseClick,backdrop:"static",keyboard:!1,children:[(0,p.jsx)(h.Z.Header,{closeButton:!0,children:(0,p.jsx)(h.Z.Title,{children:"List of User Group"})}),(0,p.jsxs)(h.Z.Body,{children:[(0,p.jsxs)(c(),{id:"grid-list",dataSource:this.props.List,keyExpr:"AutoID",showBorders:!0,wordWrapEnabled:!0,allowSearch:!0,selection:{mode:"single"},hoverStateEnabled:!0,onSelectionChanged:this.onSelectionChanged,children:[(0,p.jsx)(u.SearchPanel,{visible:!0}),(0,p.jsx)(u.GroupPanel,{visible:!0}),(0,p.jsx)(u.Paging,{defaultPageSize:20}),(0,p.jsx)(u.Column,{dataField:"AutoID",visible:!1}),(0,p.jsx)(u.Column,{dataField:"GroupCode"}),(0,p.jsx)(u.Column,{dataField:"GroupName"})]}),(0,p.jsx)("br",{}),(0,p.jsx)("br",{}),(0,p.jsx)(d.Z,{variant:"secondary",onClick:this.onSelectClick,children:"Open"}),(0,p.jsx)(d.Z,{variant:"secondary",onClick:this.onCloseClick,icon:"feather icon-layers",children:"Close"})]})]})})}}const m=g;var x=a(67810),D=a(21830),I=a.n(D),S=a(55294),j=a(65410),C=a.n(j),w=(a(51793),a(47885)),A=a(85797);class v extends i.Component{constructor(t){super(t),this.IDValidation=()=>new Promise(((t,e)=>{S.Z.get("/api/user-group-exist",{params:{AutoID:this.state.GroupID,Code:this.state.Group.GroupCode,Name:this.state.Group.GroupName}}).then((e=>{t(1===e.data[0].Exist)})).catch((t=>{console.log(t)}))})),this.OnSaveValidation=async()=>this.FormLayout.validate().isValid?!await this.IDValidation()||(this.OnNotification("Code or Name already exist","error"),!1):(this.OnNotification("Fields marked with * are required","error"),!1),this.onLoadPanelHiding=(t,e)=>{this.setState({LoadPanelVisible:!1}),this.OnNotification(t,e)},this.OnNotification=(t,e)=>{C()({message:t,type:e,displayTime:3e3,position:{at:"top right",offset:"50"}})},this.OnClickEvent=()=>{},this.SaveData=async()=>{await this.OnSaveValidation()&&I().fire({type:"info",showCancelButton:!0,text:"Do you want to save ?",confirmButtonText:"Yes",cancelButtonText:"No",allowOutsideClick:!1,allowEscapeKey:!1}).then((t=>{t.value?this.setState({LoadPanelVisible:!0},(()=>this.serverRequest=S.Z.post("/api/user-group",{GroupID:this.state.GroupID,UserGroup:JSON.stringify(this.state.Group),Authorization:JSON.stringify(this.state.Authorization)}).then((t=>{this.onLoadPanelHiding("Successfully Saved","success"),this.OnClearForm()})).catch((t=>{this.onLoadPanelHiding("Something went wrong","error"),console.log(t)})))):"cancel"==t.dismiss||t.dismiss}))},this.OnClearForm=()=>{let t=this.state.Authorization;t=t.map((t=>2!==t.Auth?{...t,Auth:2}:t)),this.setState({GroupID:0,Group:{Status:1},Authorization:t})},this.OnListClickEvent=t=>{this.setState({ListViewing:!this.state.ListViewing},(()=>{this.state.ListViewing&&(this.serverRequest=S.Z.get("/api/user-group-lookup").then((t=>{console.log(t.data),this.setState({jlGroupList:JSON.parse(t.data[0].List)})})).catch((t=>{console.log(t)}))),this.state.ListViewing||0==t||this.setState({GroupID:t},(()=>this.OnLoadData()))}))},this.onRowUpdating=t=>{9===t.newData.Auth&&(t.cancel=!0)},this.onRowUpdated=t=>{let e=this.state.Authorization;if(1===t.data.Type)e=e.map((e=>e.RootParent===t.data.MenuID||e.ParentID===t.data.MenuID?{...e,Auth:t.data.Auth}:e));else{let a=e.filter((e=>e.ParentID===t.data.ParentID)),i=e.filter((e=>e.ParentID===t.data.ParentID&&e.Auth===t.data.Auth));e=a.length===i.length?e.map((e=>e.MenuID===t.data.ParentID?{...e,Auth:t.data.Auth}:e)):e.map((e=>e.MenuID===t.data.ParentID?{...e,Auth:9}:e));let s=e.filter((e=>e.RootParent===t.data.RootParent)),o=e.filter((e=>e.RootParent===t.data.RootParent&&e.Auth===t.data.Auth));e=s.length===o.length?e.map((e=>e.MenuID===t.data.RootParent?{...e,Auth:t.data.Auth}:e)):e.map((e=>e.MenuID===t.data.RootParent?{...e,Auth:9}:e))}this.setState({Authorization:e})},this.state={GroupID:0,Group:{Status:1},Authorization:[],jlGroupList:[],ListViewing:!1,DocReadOnly:!1},this.Auth=[{ID:0,Name:"Full Authorization"},{ID:1,Name:"Read-Only"},{ID:2,Name:"No Authorization"},{ID:9,Name:"Various Authorization"}],this.Status=[{ID:1,Name:"Active"},{ID:0,Name:"Inactive"}],this.onLoadPanelHiding=this.onLoadPanelHiding.bind(this),this.SaveData=this.SaveData.bind(this),this.FormRef=i.createRef()}get FormLayout(){return this.FormRef.current.instance}componentDidMount(){S.Z.all([S.Z.get("/api/user-auth-tree")]).then(S.Z.spread((t=>{this.setState({Authorization:t.data,DocReadOnly:!1})}))).catch((t=>console.log(t)))}OnLoadData(){S.Z.all([S.Z.get("/api/user-group",{params:{GroupID:this.state.GroupID}})]).then(S.Z.spread((t=>{console.log("data view",t),this.setState({Group:JSON.parse(t.data[0].UserGroup),Authorization:JSON.parse(t.data[0].UserWiseAuthontication)})}))).catch((t=>console.log(t)))}render(){return(0,p.jsxs)(s.Z,{children:[(0,p.jsx)(o.Z,{title:"User",children:(0,p.jsx)(r(),{ref:this.FormRef,formData:this.state.Group,children:(0,p.jsxs)(n.GroupItem,{caption:"User Information",colCount:2,children:[(0,p.jsxs)(n.Item,{dataField:"GroupCode",editorOptions:{maxLength:50,readOnly:0!=this.state.GroupID},children:[(0,p.jsx)(n.RequiredRule,{message:"Field required"}),(0,p.jsx)(n.Label,{text:"Group Code"})]}),(0,p.jsx)(n.Item,{dataField:"GroupName",editorOptions:{maxLength:100},children:(0,p.jsx)(n.RequiredRule,{message:"Field required"})}),(0,p.jsx)(n.Item,{dataField:"Status",editorType:"dxSelectBox",editorOptions:{searchEnabled:!0,items:this.Status,displayExpr:"Name",valueExpr:"ID"},children:(0,p.jsx)(n.RequiredRule,{})})]})})}),(0,p.jsx)(o.Z,{title:"Authorization",children:(0,p.jsxs)(x.TreeList,{id:"user-authorization",dataSource:this.state.Authorization,columnAutoWidth:!0,wordWrapEnabled:!0,showBorders:!0,keyExpr:"MenuID",parentIdExpr:"ParentID",onRowUpdated:this.onRowUpdated,onRowUpdating:this.onRowUpdating,children:[(0,p.jsx)(x.Editing,{allowUpdating:!0,mode:"cell"}),(0,p.jsx)(x.Column,{minWidth:250,dataField:"Name",caption:"Module",allowEditing:!1,children:(0,p.jsx)(n.RequiredRule,{})}),(0,p.jsxs)(x.Column,{minWidth:120,dataField:"Auth",caption:"Authorization",children:[(0,p.jsx)(x.Lookup,{dataSource:this.Auth,valueExpr:"ID",displayExpr:"Name"}),(0,p.jsx)(n.RequiredRule,{})]})]})}),(0,p.jsxs)(l.Z,{bg:"light",variant:"light",children:[(0,p.jsx)(d.Z,{variant:"secondary",icon:"feather icon-layers",onClick:this.SaveData,disabled:this.state.DocReadOnly,children:"Save"}),(0,p.jsx)(d.Z,{variant:"secondary",icon:"feather icon-layers",onClick:this.OnClearForm,children:"Clear"}),(0,p.jsx)(d.Z,{variant:"secondary",icon:"feather icon-layers",onClick:this.OnListClickEvent,children:"View List"})]}),(0,p.jsx)(w.LoadPanel,{message:"Processing.... Please, wait...",shadingColor:"rgba(0,0,0,0.4)",onHiding:this.onLoadPanelHiding,visible:this.state.LoadPanelVisible,showIndicator:!0,shading:!0,showPane:!0,closeOnOutsideClick:!1,width:500}),(0,p.jsx)(m,{Show:this.state.ListViewing,OnHide:this.OnListClickEvent,List:this.state.jlGroupList})]})}}const L=(0,A.$j)((t=>(console.log(t.loggedReducer),{data:t.loggedReducer})))(v)}}]);
//# sourceMappingURL=598.0e107cb8.chunk.js.map